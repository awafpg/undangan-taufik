(()=>{var O=(()=>{let n=null,o=null,r=0,c=0,y=!0,v=()=>{r+=1},w=()=>(console.log(c,r),`(${c}/${r}) [${parseInt(c/r*100).toFixed(0)}%]`);return{init:()=>{n=document.getElementById("progress-info"),o=document.getElementById("progress-bar"),n.classList.remove("d-none")},add:v,invalid:d=>{console.log(`invalid ${d}`),y&&(y=!1,o.style.backgroundColor="red",n.innerText=`Error loading ${d} ${w()}`,document.dispatchEvent(new Event("progress.invalid")))},complete:(d,s=!1)=>{y&&(console.log(`[progress] complete(${d}) ${c}/${r}`),c+=1,n.innerText=`Loading ${d} ${s?"skipped":"complete"} ${w()}`,o.style.width=Math.min(c/r*100,100).toString()+"%",c===r&&document.dispatchEvent(new Event("progress.done")))}}})();var V="GET",ce="PUT",X="POST",de="PATCH",me="DELETE";var Y="AbortError",Q={Accept:"application/json","Content-Type":"application/json"},we=(()=>{let n=null;return{getInstance:()=>(n||(n=window.caches.open("request")),n)}})(),F=(n,o)=>{let r=new AbortController,c={signal:r.signal,method:String(n).toUpperCase(),headers:new Headers(Q)};window.addEventListener("offline",()=>r.abort()),window.addEventListener("popstate",()=>r.abort());let y=0,v=0,w=0,k=0,p=document.body.getAttribute("data-url");p&&p.slice(-1)==="/"&&(p=p.slice(0,-1));let $=d=>{let s=()=>{let i=()=>window.fetch(d,c);if(y===0||!window.isSecureContext)return i();if(c.method!==V)return console.warn("Only method GET can be cached"),i();let g=T=>i().then(E=>{if(!E.ok)return E;let I=E.clone(),A=new Headers(E.headers);return E.clone().arrayBuffer().then(m=>{if(!A.has("Expires")){let a=new Date(Date.now()+y);A.set("Expires",a.toUTCString())}return A.has("Content-Length")||A.set("Content-Length",String(m.byteLength)),T.put(d,new Response(E.body,{headers:A})).then(()=>I)})});return we.getInstance().then(T=>T.match(d).then(E=>{if(!E)return g(T);let I=E.headers.get("Expires"),A=I?new Date(I).getTime():0;return Date.now()>A?T.delete(d).then(m=>m?g(T):E):E}))};if(v===0&&w===0)return s();let t=async()=>{try{return await s()}catch(i){if(i.name===Y)throw i;if(w*=2,k++,k>=v)throw new Error(`Max retries reached: ${i}`);return console.warn(`Retrying fetch (${k}/${v}): ${d}`),await new Promise(g=>window.setTimeout(g,w)),t()}};return t()};return{send(d=null){return $(p+o).then(s=>s.json().then(t=>{if(s.status>=500&&(t.message??t[0]))throw new Error(t.message??t[0]);if(t.error)throw new Error(t.error[0]);return d&&(t.data=d(t.data)),t})).catch(s=>{if(s.name===Y)return console.warn("Fetch abort:",s),s;throw alert(s),new Error(s)})},withCache(d=1e3*60*60*6){return y=d,this},withRetry(d=3,s=1e3){return v=d,w=s,this},withCancel(d){return d==null?this:((async()=>(await d,r.abort()))(),this)},default(d=null){return c.headers=new Headers(d??{}),$(o)},download(){return Object.keys(Q).forEach(d=>c.headers.delete(d)),$(p+o).then(d=>{if(d.status!==200)return!1;let s=document.querySelector("a[download]");s&&document.body.removeChild(s);let t=d.headers.get("content-disposition")?.match(/filename="(.+)"/)?.[1]??"download.csv";return d.blob().then(i=>{let g=document.createElement("a"),T=window.URL.createObjectURL(i);return g.href=T,g.download=t,document.body.appendChild(g),g.click(),document.body.removeChild(g),window.URL.revokeObjectURL(T),!0})}).catch(d=>{if(d.name===Y)return console.warn("Fetch abort:",d),!1;throw alert(d),new Error(d)})},token(d){return d.split(".").length===3?(c.headers.append("Authorization","Bearer "+d),this):(c.headers.append("x-access-key",d),this)},body(d){if(c.method===V)throw new Error("GET method does not support body");return c.body=JSON.stringify(d),this}}};var ve=(()=>{let n=null;return{getInstance:o=>(n||(n=new Map),n.has(o)||n.set(o,window.caches.open(o)),n.get(o))}})(),te=n=>{let o=new Map,r=new Map,c=null,y=1e3*60*60*6,v=async()=>{!c&&window.isSecureContext&&(c=await ve.getInstance(n))},w=(p,$=null)=>{if(console.log("Fetching:",p),o.has(p))return Promise.resolve(o.get(p));if(r.has(p))return r.get(p);let d=v().then(()=>{let s=()=>F(V,p).withCancel($).withRetry().default().then(i=>i.blob().then(g=>{if(!window.isSecureContext)return g;let T=new Headers(i.headers),E=new Date(Date.now()+y);T.set("Content-Length",String(g.size)),T.set("Expires",E.toUTCString());let I=g.slice();return c.put(p,new Response(g,{headers:T})).then(()=>I)})),t=i=>(o.set(p,URL.createObjectURL(i)),o.get(p));return window.isSecureContext?c.match(p).then(i=>{if(!i)return s();let g=i.headers.get("Expires"),T=g?new Date(g).getTime():0;return Date.now()>T?c.delete(p).then(E=>E?s():i.blob()):i.blob()}).then(i=>t(i)):s().then(i=>t(i))}).finally(()=>{r.delete(p)});return r.set(p,d),d};return{run:async(p,$=null)=>{await v();let d=new Map;return window.isSecureContext||console.warn("Cache is not supported in insecure context"),p.filter(s=>s!==null).forEach(s=>{let t=d.get(s.url)??[];d.set(s.url,[...t,[s.res,s?.rej]])}),Promise.allSettled(Array.from(d).map(([s,t])=>w(s,$).then(i=>(t.forEach(g=>g[0]?.(i)),i)).catch(i=>(t.forEach(g=>g[1]?.(i)),i))))},get:w,open:v,setTtl(p){return y=Number(p),this}}};var ne=(()=>{let n=null,o=null,r=null,c=!1,y='<i class="fa-solid fa-circle-pause spin-button"></i>',v='<i class="fa-solid fa-circle-play"></i>',w=async()=>{if(!(!navigator.onLine||!n)){n.disabled=!0;try{await r,await o.play(),c=!0,n.disabled=!1,n.innerHTML=y}catch($){c=!1,alert($)}}},k=()=>{c=!1,o.pause(),n.innerHTML=v};return{init:async()=>{if(!document.body.getAttribute("data-audio")){O.complete("audio",!0);return}n=document.getElementById("button-music"),document.addEventListener("undangan.open",()=>{n.classList.remove("d-none")});try{let $=new Promise(s=>document.addEventListener("progress.invalid",s,{once:!0})),d=await te("audio").get(document.body.getAttribute("data-audio"),$);o=new Audio(d),o.volume=1,o.loop=!0,o.muted=!1,o.currentTime=0,o.autoplay=!1,o.controls=!1,r=new Promise(s=>o.addEventListener("canplay",s)),await r,O.complete("audio")}catch{O.invalid("audio")}n.addEventListener("offline",k),n.addEventListener("click",()=>c?k():w())},play:w}})();var h=(()=>{let n='<span class="spinner-border spinner-border-sm my-0 ms-0 me-1 p-0" style="height: 0.8rem; width: 0.8rem;"></span>',o=t=>String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),r=(t,i)=>(t.replaceChildren(document.createRange().createContextualFragment(i)),t),c=(t,i,g=.05)=>new Promise(T=>{let E=parseFloat(t.style.opacity),I=i?1:0,A=()=>{E+=i?g:-g,E=Math.max(0,Math.min(1,E)),t.style.opacity=E.toFixed(2),i&&E>=I||!i&&E<=I?(t.style.opacity=I.toString(),T(t)):requestAnimationFrame(A)};requestAnimationFrame(A)}),y=(t,i)=>{let g=null;g=setTimeout(()=>{t(),clearTimeout(g),g=null},i)};return{loader:n,copy:async(t,i=null,g=1500)=>{let T=t.getAttribute("data-copy");if(!T||T.length===0){alert("Nothing to copy");return}t.disabled=!0;try{await navigator.clipboard.writeText(T)}catch{t.disabled=!1,alert("Failed to copy");return}let E=t.innerHTML;r(t,i||'<i class="fa-solid fa-check"></i>'),y(()=>{t.disabled=!1,t.innerHTML=E},g)},timeOut:y,debounce:(t,i)=>{let g=null;return(...T)=>{clearTimeout(g),g=setTimeout(()=>t(...T),i)}},escapeHtml:o,base64Encode:t=>{let g=new TextEncoder().encode(t);return window.btoa(String.fromCharCode(...g))},base64Decode:t=>{let i=new TextDecoder,g=Uint8Array.from(window.atob(t),T=>T.charCodeAt(0));return i.decode(g)},disableButton:(t,i="Loading",g=!1)=>{t.disabled=!0;let T=t.innerHTML;return r(t,g?i:n+i),{restore:(E=!1)=>{t.innerHTML=T,t.disabled=E}}},disableCheckbox:t=>{t.disabled=!0;let i=document.querySelector(`label[for="${t.id}"]`),g=i.innerHTML;return r(i,n+g),{restore:()=>{i.innerHTML=g,t.disabled=!1}}},safeInnerHTML:r,parseUserAgent:t=>{let i=[{type:"Mobile",regex:/Android.*Mobile|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i},{type:"Tablet",regex:/iPad|Android(?!.*Mobile)|Tablet/i},{type:"Desktop",regex:/Windows NT|Macintosh|Linux/i}],g=[{name:"Chrome",regex:/Chrome|CriOS/i},{name:"Safari",regex:/Safari/i},{name:"Edge",regex:/Edg|Edge/i},{name:"Firefox",regex:/Firefox|FxiOS/i},{name:"Opera",regex:/Opera|OPR/i},{name:"Internet Explorer",regex:/MSIE|Trident/i}],T=[{name:"Windows",regex:/Windows NT ([\d.]+)/i},{name:"MacOS",regex:/Mac OS X ([\d_]+)/i},{name:"Android",regex:/Android ([\d.]+)/i},{name:"iOS",regex:/OS ([\d_]+) like Mac OS X/i},{name:"Linux",regex:/Linux/i}],E=i.find(f=>f.regex.test(t))?.type||"Unknown",I=g.find(f=>f.regex.test(t))?.name||"Unknown",A=T.find(f=>f.regex.test(t)),m=A&&t.match(A.regex)?.[1]?.replace(/_/g,".")||"",a=A?A.name:"Unknown";return m=m?`${a} ${m}`:a,`${I} ${E} ${m}`},changeOpacity:c}})();var H=n=>{let o=(w=null)=>{let k=JSON.parse(localStorage.getItem(n));return w?k[String(w)]:k},r=(w,k)=>{let p=o();p[String(w)]=k,localStorage.setItem(n,JSON.stringify(p))},c=w=>Object.keys(o()).includes(String(w)),y=w=>{if(!c(w))return;let k=o();delete k[String(w)],localStorage.setItem(n,JSON.stringify(k))},v=()=>localStorage.setItem(n,"{}");return localStorage.getItem(n)||v(),{set:r,get:o,has:c,clear:v,unset:y}};var Z=(()=>{let n={"#000000":"#ffffff","#ffffff":"#000000","#212529":"#f8f9fa","#f8f9fa":"#212529"},o=["#ffffff","#f8f9fa"],r=["#000000","#212529"],c=!1,y=null,v=null,w=()=>y.set("active","light"),k=()=>y.set("active","dark"),p=E=>{let I=v.getAttribute("content");v.setAttribute("content",E.some(A=>A===I)?n[I]:I)},$=()=>{w(),document.documentElement.setAttribute("data-bs-theme","light"),p(r)},d=()=>{k(),document.documentElement.setAttribute("data-bs-theme","dark"),p(o)},s=(E=null,I=null)=>{let A=y.get("active")==="dark";return E&&I?A?E:I:A};return{init:()=>{switch(y=H("theme"),v=document.querySelector('meta[name="theme-color"]'),y.has("active")||(window.matchMedia("(prefers-color-scheme: dark)").matches?k():w()),document.documentElement.getAttribute("data-bs-theme")){case"dark":k();break;case"light":w();break;default:c=!0}s()?d():$()},spyTop:()=>{let E=A=>A.filter(m=>m.isIntersecting).forEach(m=>{let a=m.target.classList.contains("bg-white-black")?s(r[0],o[0]):s(r[1],o[1]);v.setAttribute("content",a)}),I=new IntersectionObserver(E,{rootMargin:"0% 0% -95% 0%"});document.querySelectorAll("section").forEach(A=>I.observe(A))},change:()=>s()?$():d(),isDarkMode:s,isAutoMode:()=>c}})();var J=(()=>{let n={id:"ID",en:"US",fr:"FR",de:"DE",es:"ES",zh:"CN",ja:"JP",ko:"KR",ar:"SA",ru:"RU",it:"IT",nl:"NL",pt:"PT",tr:"TR",th:"TH",vi:"VN",ms:"MY",hi:"IN"},o=null,r=null,c=null,y=null;return{on(v,w){return y.set(v,w),this},get(){let v=y.get(c);return y.clear(),v},getCountry(){return o},getLocale(){return r},getLanguage(){return c},setDefault(v){let w=!0;n[v]||(w=!1,console.warn("Language not found, please add manually in countryMapping")),o=w?n[v]:"US",c=w?v:"en",r=`${c}_${o}`},init(){y=new Map,this.setDefault(navigator.language.split("-").shift())}}})();var z=(()=>{let n=(s=0)=>({love:s}),o=({uuid:s,own:t,name:i,presence:g,comment:T,created_at:E,is_admin:I,is_parent:A,gif_url:m,ip:a,user_agent:f,comments:e,like:b})=>({uuid:s,own:t,name:i,presence:g,comment:T,created_at:E,is_admin:I??!1,is_parent:A,gif_url:m,ip:a,user_agent:f,comments:e?.map(o)??[],like:n(b?.love??0)}),r=s=>s.map(o);return{uuidResponse:({uuid:s})=>({uuid:s}),tokenResponse:({token:s})=>({token:s}),statusResponse:({status:s})=>({status:s}),likeCommentResponse:n,getCommentResponse:o,getCommentsResponse:r,getCommentsResponseV2:s=>({count:s.count,lists:r(s.lists)}),commentShowMore:(s,t=!1)=>({uuid:s,show:t}),postCommentRequest:(s,t,i,g,T)=>({id:s,name:t,presence:i,comment:g,gif_id:T}),postSessionRequest:(s,t)=>({email:s,password:t}),updateCommentRequest:(s,t,i)=>({presence:s,comment:t,gif_id:i})}})();var R=(()=>{let n=null,o=()=>n.get("token"),r=$=>n.set("token",$),c=$=>F(X,"/api/session").body($).send(z.tokenResponse).then(d=>(d.code===200&&r(d.data.token),d.code===200),()=>!1),y=()=>n.unset("token"),v=()=>String(o()??".").split(".").length===3;return{init:()=>{n=H("session")},guest:()=>F(V,"/api/v2/config").withCache(1e3*60*60*1).token(o()).send().then($=>{if($.code!==200)throw new Error("failed to get config.");let d=H("config");for(let[s,t]of Object.entries($.data))d.set(s,t);return $}),login:c,logout:y,decode:()=>{if(!v())return null;try{return JSON.parse(h.base64Decode(o().split(".")[1]))}catch{return null}},isAdmin:v,setToken:r,getToken:o}})();var ue=(()=>{let n=null,o=!0,r=["input[data-offline-disabled]","button[data-offline-disabled]","select[data-offline-disabled]","textarea[data-offline-disabled]"],c=()=>o,y=()=>{let s=n.firstElementChild.firstElementChild;s.classList.remove("bg-success"),s.classList.add("bg-danger"),s.firstElementChild.innerHTML='<i class="fa-solid fa-ban me-2"></i>Koneksi tidak tersedia'},v=()=>{let s=n.firstElementChild.firstElementChild;s.classList.remove("bg-danger"),s.classList.add("bg-success"),s.firstElementChild.innerHTML='<i class="fa-solid fa-cloud me-2"></i>Koneksi tersedia kembali'},w=async()=>{o&&(await h.changeOpacity(n,!1),y())},k=()=>{document.querySelectorAll(r.join(", ")).forEach(s=>{s.dispatchEvent(new Event(c()?"online":"offline")),s.setAttribute("data-offline-disabled",c()?"false":"true"),s.tagName==="BUTTON"?c()?s.classList.remove("disabled"):s.classList.add("disabled"):c()?s.removeAttribute("disabled"):s.setAttribute("disabled","true")})},p=()=>{o=!1,y(),h.changeOpacity(n,!0),k()},$=()=>{o=!0,v(),h.timeOut(w,3e3),k()};return{init:()=>{window.addEventListener("online",$),window.addEventListener("offline",p),n=document.createElement("div"),n.classList.add("fixed-top","pe-none"),n.style.cssText="opacity: 0; z-index: 1057;",n.innerHTML=`
        <div class="d-flex justify-content-center mx-auto">
            <div class="d-flex justify-content-center align-items-center rounded-pill my-2 bg-danger shadow">
                <small class="text-center py-1 px-2 mx-1 mt-1 mb-0 text-white" style="font-size: 0.8rem;"></small>
            </div>
        </div>`,document.body.insertBefore(n,document.body.lastChild)},isOnline:c}})();var B=(()=>{let n="default",o={128:2,256:3,512:4,768:5},r=null,c=null,y=null,v=null,w=!0,k=(u,l,x=null)=>{let C=c.get(u);return l.map(q=>{let{id:D,media_formats:{tinygif:{url:j}},content_description:M}=q;C.pointer===-1||C.pointer===C.col-1?C.pointer=0:C.pointer++;let ee=C.lists.childNodes[C.pointer]??null;return ee?{url:j,res:ae=>{ee.insertAdjacentHTML("beforeend",`
                <figure class="gif-figure m-0 position-relative">
                    <button onclick="undangan.comment.gif.click(this, '${C.uuid}', '${D}', '${h.base64Encode(j)}')" class="btn gif-checklist position-absolute justify-content-center align-items-center top-0 end-0 bg-overlay-auto p-1 m-1 rounded-circle border shadow-sm z-1">
                        <i class="fa-solid fa-circle-check"></i>
                    </button>
                    <img src="${ae}" class="img-fluid" alt="${h.escapeHtml(M)}" style="width: 100%;">
                </figure>`),x?.step()}}:null})},p=()=>r.open(),$=u=>r.get(u),d=u=>{let l=c.get(u),x=l.lists,C=document.getElementById(`gif-loading-${l.uuid}`),q=document.getElementById(`progress-bar-${l.uuid}`),D=document.getElementById(`progress-info-${l.uuid}`),j=0,M=0;x.setAttribute("data-continue","false"),x.classList.replace("overflow-y-scroll","overflow-y-hidden");let ee=150,se=!1,ae=setTimeout(()=>{se||(D.innerText=`${M}/${j}`,x.classList.contains("d-none")||C.classList.replace("d-none","d-flex"))},ee);return{release:()=>{se=!0,clearTimeout(ae),x.classList.contains("d-none")||C.classList.replace("d-flex","d-none"),q.style.width="0%",D.innerText=`${M}/${j}`,x.setAttribute("data-continue","true"),x.classList.replace("overflow-y-hidden","overflow-y-scroll")},until:ye=>{j=ye,D.innerText=`${M}/${j}`},step:()=>{M+=1,D.innerText=`${M}/${j}`,q.style.width=Math.min(M/j*100,100).toString()+"%"}}},s=(u,l,x)=>{x={media_filter:"tinygif",client_key:"undangan_app",key:v.get("tenor_key"),country:J.getCountry(),locale:J.getLocale(),...x??{}};let C=Object.keys(x).filter(M=>x[M]!==null&&x[M]!==void 0).map(M=>`${M}=${encodeURIComponent(x[M])}`).join("&"),q=d(u),D=c.get(u),j=new Promise(M=>{D.reqs.push(M)});D.last=F(V,`https://tenor.googleapis.com/v2${l}?${C}`).withCache().withRetry().withCancel(j).default(Q).then(M=>M.json()).then(M=>{if(M.error)throw new Error(M.error.message);return M.results.length===0?M:(D.next=M?.next,q.until(M.results.length),D.gifs.push(...M.results),r.run(k(u,M.results,q),j))}).catch(M=>{M.name===Y?console.warn("Fetch abort:",M):alert(M)}).finally(()=>q.release())},t=u=>(u=h.escapeHtml(u),`
        <label for="gif-search-${u}" class="form-label my-1"><i class="fa-solid fa-photo-film me-2"></i>Gif</label>

        <div class="d-flex mb-3" id="gif-search-nav-${u}">
            <button class="btn btn-secondary btn-sm rounded-4 shadow-sm me-1 my-1" onclick="undangan.comment.gif.back(this, '${u}')" data-offline-disabled="false"><i class="fa-solid fa-arrow-left"></i></button>
            <input type="text" name="gif-search" id="gif-search-${u}" autocomplete="on" class="form-control shadow-sm rounded-4" placeholder="Search for a GIF on Tenor" data-offline-disabled="false">
        </div>

        <div class="position-relative">
            <div class="position-absolute d-flex flex-column justify-content-center align-items-center top-50 start-50 translate-middle w-100 h-100 bg-overlay-auto rounded-4 z-3" id="gif-loading-${u}">
                <div class="progress w-25" role="progressbar" style="height: 0.5rem;" aria-label="progress bar">
                    <div class="progress-bar" id="progress-bar-${u}" style="width: 0%"></div>
                </div>
                <small class="mt-1 text-theme-auto bg-theme-auto py-0 px-2 rounded-4" id="progress-info-${u}" style="font-size: 0.7rem;"></small>
            </div>
            <div id="gif-lists-${u}" class="d-flex rounded-4 p-0 overflow-y-scroll border" data-continue="true" style="height: 15rem;"></div>
        </div>

        <figure class="d-flex m-0 position-relative" id="gif-result-${u}">
            <button onclick="undangan.comment.gif.cancel('${u}')" id="gif-cancel-${u}" class="btn d-none position-absolute justify-content-center align-items-center top-0 end-0 bg-overlay-auto p-2 m-1 rounded-circle border shadow-sm z-1">
                <i class="fa-solid fa-circle-xmark"></i>
            </button>
        </figure>`),i=async u=>{let l=c.get(u);l.reqs.forEach(x=>x()),l.reqs.length=0,l.last&&(await l.last,l.last=null)},g=async u=>{await i(u);let l=c.get(u),x=l.col??0,C=0;for(let[q,D]of Object.entries(o))C=D,l.lists.clientWidth>=parseInt(q)&&(l.col=C);if(l.col===null&&(l.col=C),x!==l.col&&(l.pointer=-1,l.limit=l.col*5,l.lists.innerHTML='<div class="d-flex flex-column"></div>'.repeat(l.col),l.gifs.length!==0)){try{await r.run(k(u,l.gifs))}catch{l.gifs.length=0}x!==l.col&&l.lists.scroll({top:l.lists.scrollHeight,behavior:"instant"}),l.gifs.length===0&&await g(u)}},T=async u=>{let l=c.get(u);if(l.lists.getAttribute("data-continue")!=="true"||!l.next||l.next.length===0)return;let x=l.query&&l.query.trim().length>0,C={pos:l.next,limit:l.limit};x&&(C.q=l.query),l.lists.scrollTop>(l.lists.scrollHeight-l.lists.clientHeight)*.8&&(await g(u),s(u,x?"/search":"/featured",C))},E=async(u,l=null)=>{let x=c.get(u);x.query=l!==null?l:x.query,(!x.query||x.query.trim().length===0)&&(x.query=null),x.col=null,x.next=null,x.pointer=-1,x.gifs.length=0,await g(u),s(u,x.query===null?"/featured":"/search",{q:x.query,limit:x.limit})};return{default:n,init:()=>{r=te("gif"),c=new Map,y=new Map,v=H("config"),v.get("tenor_key")||(w=!1,document.querySelector('[onclick="undangan.comment.gif.open(undangan.comment.gif.default)"]')?.remove())},get:$,back:async(u,l)=>{let x=h.disableButton(u,h.loader.replace("me-1","me-0"),!0);await i(l),x.restore(),document.getElementById(`gif-form-${l}`).classList.toggle("d-none",!0),document.getElementById(`comment-form-${l}`)?.classList.toggle("d-none",!1)},open:u=>{if(!c.has(u)){h.safeInnerHTML(document.getElementById(`gif-form-${u}`),t(u));let l=document.getElementById(`gif-lists-${u}`);c.set(u,{uuid:u,lists:l,last:null,limit:null,query:null,next:null,col:null,pointer:-1,gifs:[],reqs:[]});let x=h.debounce(T,150);l.addEventListener("scroll",()=>x(u));let C=h.debounce(E,850);document.getElementById(`gif-search-${u}`).addEventListener("input",q=>C(u,q.target.value))}return document.getElementById(`gif-form-${u}`).classList.toggle("d-none",!1),document.getElementById(`comment-form-${u}`)?.classList.toggle("d-none",!0),y.has(u)&&y.get(u)(),E(u)},cancel:u=>{let l=document.getElementById(`gif-result-${u}`);l.removeAttribute("data-id"),l.querySelector(`#gif-cancel-${u}`).classList.replace("d-flex","d-none"),l.querySelector("img").remove(),c.get(u).lists.classList.replace("d-none","d-flex"),document.getElementById(`gif-search-nav-${u}`).classList.replace("d-none","d-flex")},click:async(u,l,x,C)=>{let q=h.disableButton(u,h.loader.replace("me-1","me-0"),!0),D=document.getElementById(`gif-result-${l}`);D.setAttribute("data-id",x),D.querySelector(`#gif-cancel-${l}`).classList.replace("d-none","d-flex"),D.insertAdjacentHTML("beforeend",`<img src="${await r.get(h.base64Decode(C))}" class="img-fluid mx-auto gif-image rounded-4" alt="selected-gif">`),q.restore(),c.get(l).lists.classList.replace("d-flex","d-none"),document.getElementById(`gif-search-nav-${l}`).classList.replace("d-flex","d-none")},remove:async(u=null)=>{u?c.has(u)&&(await i(u),y.delete(u),c.delete(u)):(await Promise.allSettled(Array.from(c.keys()).map(l=>i(l))),y.clear(),c.clear())},isOpen:u=>{let l=document.getElementById(`gif-form-${u}`);return l&&!l.classList.contains("d-none")},onOpen:(u,l)=>y.set(u,l),isActive:()=>w,getResultId:u=>document.getElementById(`gif-result-${u}`)?.getAttribute("data-id"),buttonCancel:(u=null)=>{let l=document.getElementById(`gif-cancel-${u||n}`);return{show:()=>l.classList.replace("d-none","d-flex"),hide:()=>l.classList.replace("d-flex","d-none"),click:()=>l.dispatchEvent(new Event("click"))}},removeGifSearch:u=>document.querySelector(`[for="gif-search-${u}"]`)?.remove(),removeButtonBack:u=>document.querySelector(`[onclick="undangan.comment.gif.back(this, '${u}')"]`)?.remove(),prepareCache:p}})();var U=(()=>{let n=null,o=null,r=null,c=null,y=300,v=[["*",'<strong class="text-theme-auto">$1</strong>'],["_",'<em class="text-theme-auto">$1</em>'],["~",'<del class="text-theme-auto">$1</del>'],["```",'<code class="font-monospace text-theme-auto">$1</code>']],w=()=>`
        <div class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4">
            <div class="d-flex justify-content-between align-items-center placeholder-wave">
                <span class="placeholder bg-secondary col-5 rounded-3 my-1"></span>
                <span class="placeholder bg-secondary col-3 rounded-3 my-1"></span>
            </div>
            <hr class="my-1">
            <p class="placeholder-wave m-0">
                <span class="placeholder bg-secondary col-6 rounded-3"></span>
                <span class="placeholder bg-secondary col-5 rounded-3"></span>
                <span class="placeholder bg-secondary col-12 rounded-3 my-1"></span>
            </p>
        </div>`,k=e=>(v.forEach(([b,L])=>{e=e.replace(new RegExp(`\\${b}(?=\\S)(.*?)(?<!\\s)\\${b}`,"gs"),L)}),e),p=e=>`
        <button style="font-size: 0.8rem;" onclick="undangan.comment.like.love(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto ms-auto rounded-3 p-0 shadow-sm d-flex justify-content-start align-items-center" data-offline-disabled="false">
            <span class="my-0 mx-1" data-count-like="${e.like.love}">${e.like.love}</span>
            <i class="me-1 ${o.has(e.uuid)?"fa-solid fa-heart text-danger":"fa-regular fa-heart"}"></i>
        </button>`,$=e=>{let b=`<div class="d-flex justify-content-start align-items-center" data-button-action="${e.uuid}">`;return r.get("can_reply")!==!1&&(b+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.reply('${e.uuid}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Reply</button>`),R.isAdmin()&&e.is_admin&&(!e.gif_url||B.isActive())?b+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.edit(this, ${e.is_parent?"true":"false"})" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-own="${e.own}" data-offline-disabled="false">Edit</button>`:n.has(e.uuid)&&r.get("can_edit")!==!1&&(!e.gif_url||B.isActive())&&(b+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.edit(this, ${e.is_parent?"true":"false"})" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Edit</button>`),R.isAdmin()?b+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-own="${e.own}" data-offline-disabled="false">Delete</button>`:n.has(e.uuid)&&r.get("can_delete")!==!1&&(b+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Delete</button>`),b+="</div>",b},d=(e,b)=>{e=h.escapeHtml(e);let L=c.get("show").includes(e);return`<a class="text-theme-auto" style="font-size: 0.8rem;" onclick="undangan.comment.showOrHide(this)" data-uuid="${e}" data-uuids="${h.escapeHtml(b.join(","))}" data-show="${L?"true":"false"}" role="button" class="me-auto ms-1 py-0">${L?"Hide replies":`Show replies (${b.length})`}</a>`},s=e=>`
        <div class="d-flex justify-content-between align-items-center" id="button-${e.uuid}">
            ${$(e)}
            ${e.comments.length>0?d(e.uuid,e.comments.map(b=>b.uuid)):""}
            ${p(e)}
        </div>`,t=e=>!e.ip||!e.user_agent||e.is_admin?"":`
        <div class="mb-1 mt-3">
            <p class="text-theme-auto mb-1 mx-0 mt-0 p-0" style="font-size: 0.7rem;" id="ip-${e.uuid}"><i class="fa-solid fa-location-dot me-1"></i>${h.escapeHtml(e.ip)} <span class="mb-1 placeholder col-2 rounded-3"></span></p>
            <p class="text-theme-auto m-0 p-0" style="font-size: 0.7rem;"><i class="fa-solid fa-mobile-screen-button me-1"></i>${h.parseUserAgent(h.escapeHtml(e.user_agent))}</p>
        </div>`,i=e=>e.is_parent?'class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4"':`class="${c.get("hidden").find(b=>b.uuid===e.uuid).show?"":"d-none"} overflow-x-scroll mw-100 border-start bg-theme-auto py-2 ps-2 pe-0 my-2 ms-2 me-0"`,g=e=>e.is_admin?`<strong class="me-1">${h.escapeHtml(e.name)}</strong><i class="fa-solid fa-certificate text-primary"></i>`:e.is_parent?`<strong class="me-1">${h.escapeHtml(e.name)}</strong><i id="badge-${e.uuid}" data-is-presence="${e.presence?"true":"false"}" class="fa-solid ${e.presence?"fa-circle-check text-success":"fa-circle-xmark text-danger"}"></i>`:`<strong>${h.escapeHtml(e.name)}</strong>`,T=async e=>{let b=`
        <div class="d-flex justify-content-between align-items-center">
            <p class="text-theme-auto text-truncate m-0 p-0" style="font-size: 0.95rem;">${g(e)}</p>
            <small class="text-theme-auto m-0 p-0" style="font-size: 0.75rem;">${e.created_at}</small>
        </div>
        <hr class="my-1">`;if(e.gif_url)return b+`
            <div class="d-flex justify-content-center align-items-center my-2">
                <img src="${await B.get(e.gif_url)}" id="img-gif-${e.uuid}" class="img-fluid mx-auto gif-image rounded-4" alt="selected-gif">
            </div>`;let L=e.comment.length>y,S=k(h.escapeHtml(L?e.comment.slice(0,y)+"...":e.comment));return b+`
        <p class="text-theme-auto my-1 mx-0 p-0" style="white-space: pre-wrap !important; font-size: 0.95rem;" data-comment="${h.base64Encode(e.comment)}" id="content-${e.uuid}">${S}</p>
        ${L?`<p class="d-block mb-2 mt-0 mx-0 p-0"><a class="text-theme-auto" role="button" style="font-size: 0.85rem;" data-show="false" onclick="undangan.comment.showMore(this, '${e.uuid}')">Selengkapnya</a></p>`:""}`},E=async e=>{let b=await T(e),L=await Promise.all(e.comments.map(S=>E(S)));return`
        <div ${i(e)} id="${e.uuid}" style="overflow-wrap: break-word !important;">
            <div id="body-content-${e.uuid}" data-tapTime="0" data-liked="false" tabindex="0">${b}</div>
            ${t(e)}
            ${s(e)}
            <div id="reply-content-${e.uuid}">${L.join("")}</div>
        </div>`};return{init:()=>{n=H("owns"),o=H("likes"),r=H("config"),c=H("comment")},renderEdit:(e,b,L,S)=>{e=h.escapeHtml(e);let P=document.createElement("div");P.classList.add("my-2"),P.id=`inner-${e}`;let _=`
        <p class="my-1 mx-0 p-0" style="font-size: 0.95rem;"><i class="fa-solid fa-pen me-2"></i>Edit</p>
        ${L?`
        <select class="form-select shadow-sm mb-2 rounded-4" id="form-inner-presence-${e}" data-offline-disabled="false">
            <option value="1" ${b?"selected":""}>&#9989; Datang</option>
            <option value="2" ${b?"":"selected"}>&#10060; Berhalangan</option>
        </select>`:""}
        ${S?`${B.isActive()?`<div class="d-none mb-2" id="gif-form-${e}"></div>`:""}`:`<textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type update comment" rows="3" data-offline-disabled="false"></textarea>    
        `}
        <div class="d-flex justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel(this, '${e}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.update(this)" data-uuid="${e}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Update</button>
        </div>`;return h.safeInnerHTML(P,_)},renderReply:e=>{e=h.escapeHtml(e);let b=document.createElement("div");b.classList.add("my-2"),b.id=`inner-${e}`;let L=`
        <p class="my-1 mx-0 p-0" style="font-size: 0.95rem;"><i class="fa-solid fa-reply me-2"></i>Reply</p>
        <div class="d-block mb-2" id="comment-form-${e}">
            <div class="position-relative">
                ${B.isActive()?`<button class="btn btn-secondary btn-sm rounded-4 shadow-sm me-1 my-1 position-absolute bottom-0 end-0" onclick="undangan.comment.gif.open('${e}')" aria-label="button gif" data-offline-disabled="false"><i class="fa-solid fa-photo-film"></i></button>`:""}
                <textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type reply comment" rows="3" data-offline-disabled="false"></textarea>
            </div>
        </div>
        <div class="d-none mb-2" id="gif-form-${e}"></div>
        <div class="d-flex justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel(this, '${e}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.send(this)" data-uuid="${e}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Send</button>
        </div>`;return h.safeInnerHTML(b,L)},renderLoading:w,renderReadMore:d,renderContentMany:e=>B.prepareCache().then(()=>Promise.all(e.map(b=>E(b)))).then(b=>b.join("")),renderContentSingle:e=>B.prepareCache().then(()=>E(e)),convertMarkdownToHTML:k,maxCommentLength:y}})();var re=()=>new Promise((n,o)=>{let r=document.createElement("script");r.onload=n,r.onerror=o,r.src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.js",r.integrity="sha256-4QOrAnhDOdVsk8o96+LFopk3LK/FIVFI1VKD3gRuhtE=",r.crossOrigin="anonymous",document.head.appendChild(r)}),fe=()=>window.confetti.shapeFromPath({path:"M167 72c19,-38 37,-56 75,-56 42,0 76,33 76,75 0,76 -76,151 -151,227 -76,-76 -151,-151 -151,-227 0,-42 33,-75 75,-75 38,0 57,18 76,56z",matrix:[.03333333333333333,0,0,.03333333333333333,-5.566666666666666,-5.533333333333333]}),ge=()=>{window.confetti&&window.confetti({origin:{y:1},zIndex:1057})},pe=(n=15)=>{if(!window.confetti)return;let o=n*1e3,r=Date.now()+o,c=fe(),y=["#FFC0CB","#FF1493","#C71585"],v=(k,p)=>Math.random()*(p-k)+k,w=()=>{let k=r-Date.now();y.forEach(p=>{window.confetti({particleCount:1,startVelocity:0,ticks:Math.max(50,75*(k/o)),origin:{x:Math.random(),y:Math.abs(Math.random()-k/o)},zIndex:1057,colors:[p],shapes:[c],drift:v(-.5,.5),gravity:v(.5,1),scalar:v(.5,1)})}),k>0&&requestAnimationFrame(w)};requestAnimationFrame(w)},he=n=>{if(!window.confetti)return;let o=Date.now()+25,r=Math.max(.3,Math.min(1,n.getBoundingClientRect().top/window.innerHeight+.2)),c=fe(),y=["#FF69B4","#FF1493"],v=()=>{y.forEach(w=>{window.confetti({particleCount:2,angle:60,spread:55,shapes:[c],origin:{x:0,y:r},zIndex:1057,colors:[w]}),window.confetti({particleCount:2,angle:120,spread:55,shapes:[c],origin:{x:1,y:r},zIndex:1057,colors:[w]})}),Date.now()<o&&requestAnimationFrame(v)};requestAnimationFrame(v)};var K=(()=>{let n=null,o=null,r=async p=>{let $=p.firstElementChild,d=p.lastElementChild,s=p.getAttribute("data-uuid"),t=parseInt($.getAttribute("data-count-like"));p.disabled=!0,navigator.vibrate&&navigator.vibrate(100),n.has(s)?await F(de,"/api/comment/"+n.get(s)).token(R.getToken()).send(z.statusResponse).then(i=>{i.data.status&&(n.unset(s),d.classList.remove("fa-solid","text-danger"),d.classList.add("fa-regular"),$.setAttribute("data-count-like",String(t-1)))}):await F(X,"/api/comment/"+s).token(R.getToken()).send(z.uuidResponse).then(i=>{i.code===201&&(n.set(s,i.data.uuid),d.classList.remove("fa-regular"),d.classList.add("fa-solid","text-danger"),$.setAttribute("data-count-like",String(t+1)))}),$.innerText=$.getAttribute("data-count-like"),p.disabled=!1},c=p=>document.querySelector(`button[onclick="undangan.comment.like.love(this)"][data-uuid="${p}"]`),y=async p=>{if(!navigator.onLine)return;let $=Date.now(),d=$-parseInt(p.getAttribute("data-tapTime")),s=p.id.replace("body-content-",""),t=d<300&&d>0,i=!n.has(s)&&p.getAttribute("data-liked")!=="true";t&&i&&(he(p),p.setAttribute("data-liked","true"),await r(c(s)),p.setAttribute("data-liked","false")),p.setAttribute("data-tapTime",$)};return{init:()=>{o=new Map,n=H("likes")},love:r,tapTap:y,getButtonLike:c,addListener:p=>{let $=new AbortController,d=document.getElementById(`body-content-${p}`);d.addEventListener("touchend",()=>y(d),{signal:$.signal}),o.set(p,$)},removeListener:p=>{let $=o.get(p);$&&($.abort(),o.delete(p))}}})();var G=(()=>{let n=10,o=0,r=0,c=null,y=null,v=null,w=null,k=null,p=a=>{n=Number(a)},$=()=>n,d=()=>o,s=()=>r,t=()=>y.classList.contains("disabled")?null:y.classList.add("disabled"),i=()=>y.classList.contains("disabled")?y.classList.remove("disabled"):null,g=()=>v.classList.contains("disabled")?null:v.classList.add("disabled"),T=()=>v.classList.contains("disabled")?v.classList.remove("disabled"):null,E=a=>{g(),t();let f=h.disableButton(a,h.loader.replace("ms-0 me-1","mx-1"),!0),e=()=>{k.addEventListener("comment.done",()=>f.restore(),{once:!0}),k.addEventListener("comment.result",()=>k.scrollIntoView(),{once:!0}),k.dispatchEvent(new Event("comment.show"))};return{next:()=>{o+=n,a.innerHTML="Next"+a.innerHTML,e()},prev:()=>{o-=n,a.innerHTML=a.innerHTML+"Prev",e()}}};return{init:()=>{w=document.getElementById("pagination"),w.innerHTML=`
        <ul class="pagination mb-2 shadow-sm rounded-4">
            <li class="page-item disabled" id="previous">
                <button class="page-link rounded-start-4" onclick="undangan.comment.pagination.previous(this)" data-offline-disabled="false">
                    <i class="fa-solid fa-circle-left me-1"></i>Prev
                </button>
            </li>
            <li class="page-item disabled">
                <span class="page-link text-theme-auto" id="page"></span>
            </li>
            <li class="page-item" id="next">
                <button class="page-link rounded-end-4" onclick="undangan.comment.pagination.next(this)" data-offline-disabled="false">
                    Next<i class="fa-solid fa-circle-right ms-1"></i>
                </button>
            </li>
        </ul>`,k=document.getElementById("comments"),c=document.getElementById("page"),y=document.getElementById("previous"),v=document.getElementById("next")},setPer:p,getPer:$,getNext:d,reset:()=>o===0?!1:(o=0,g(),t(),!0),setTotal:a=>{if(r=Number(a),r<=n&&o===0){w.classList.add("d-none");return}let f=o/n+1,e=Math.ceil(r/n);if(c.innerText=`${f} / ${e}`,o>0&&i(),f>=e){g();return}T(),w.classList.contains("d-none")&&w.classList.remove("d-none")},geTotal:s,previous:a=>E(a).prev(),next:a=>E(a).next()}})();var oe=(()=>{let n=null,o=null,r=null,c=[],y=()=>`<div class="text-center p-4 mx-0 mt-0 mb-3 bg-theme-auto rounded-4 shadow"><p class="fw-bold p-0 m-0" style="font-size: 0.95rem;">${J.on("id","\u{1F4E2} Yuk, share undangan ini biar makin rame komentarnya! \u{1F389}").on("en","\u{1F4E2} Let's share this invitation to get more comments! \u{1F389}").get()}</p></div>`,v=(m,a)=>{document.querySelector(`[data-button-action="${m}"]`).childNodes.forEach(f=>{f.disabled=a})},w=m=>{v(m,!1),document.getElementById(`inner-${m}`).remove()},k=m=>{let a=m.getAttribute("data-uuids").split(","),f=m.getAttribute("data-show")==="true",e=m.getAttribute("data-uuid");f?(m.setAttribute("data-show","false"),m.innerText=`Show replies (${a.length})`,o.set("show",o.get("show").filter(b=>b!==e))):(m.setAttribute("data-show","true"),m.innerText="Hide replies",o.set("show",o.get("show").concat([e])));for(let b of a){o.set("hidden",o.get("hidden").map(S=>(S.uuid===b&&(S.show=!f),S)));let L=document.getElementById(b).classList;f?L.add("d-none"):L.remove("d-none")}},p=(m,a)=>{let f=document.getElementById(`content-${a}`),e=h.base64Decode(f.getAttribute("data-comment")),b=m.getAttribute("data-show")==="false";h.safeInnerHTML(f,U.convertMarkdownToHTML(h.escapeHtml(b?e:e.slice(0,U.maxCommentLength)+"..."))),m.innerText=b?"Sebagian":"Selengkapnya",m.setAttribute("data-show",b?"true":"false")},$=async m=>{if(!R.isAdmin()||(m.comments&&await Promise.all(m.comments.map(f=>$(f))),!m.ip||!m.user_agent||m.is_admin))return;let a=f=>{let e=document.getElementById(`ip-${h.escapeHtml(m.uuid)}`);h.safeInnerHTML(e,`<i class="fa-solid fa-location-dot me-1"></i>${h.escapeHtml(m.ip)} <strong>${h.escapeHtml(f)}</strong>`)};await F(V,`https://freeipapi.com/api/json/${m.ip}`).withCache().withRetry().default(Q).then(f=>f.json()).then(f=>{let e=f.cityName+" - "+f.regionName;f.cityName==="-"&&f.regionName==="-"&&(e="localhost"),a(e)}).catch(f=>a(f.message))},d=(m,a=[])=>(m.forEach(f=>{a.find(e=>e.uuid===f.uuid)||a.push(z.commentShowMore(f.uuid)),f.comments&&f.comments.length>0&&d(f.comments,a)}),a),s=()=>(c.forEach(m=>{K.removeListener(m)}),r.getAttribute("data-loading")==="false"&&(r.setAttribute("data-loading","true"),r.innerHTML=U.renderLoading().repeat(G.getPer())),F(V,`/api/v2/comment?per=${G.getPer()}&next=${G.getNext()}&lang=${J.getLanguage()}`).token(R.getToken()).send(z.getCommentsResponseV2).then(async m=>{r.setAttribute("data-loading","false");for(let f of c)await B.remove(f);if(m.data.lists.length===0)return r.innerHTML=y(),m;c.length=0,c.push(...d(m.data.lists).map(f=>f.uuid)),o.set("hidden",d(m.data.lists,o.get("hidden")));let a=await U.renderContentMany(m.data.lists);return m.data.lists.length<G.getPer()&&(a+=y()),h.safeInnerHTML(r,a),c.forEach(f=>{K.addListener(f)}),m}).then(async m=>(r.dispatchEvent(new Event("comment.result")),m.data.lists&&await Promise.all(m.data.lists.map(a=>$(a))),G.setTotal(m.data.count),r.dispatchEvent(new Event("comment.done")),m)));return{gif:B,like:K,pagination:G,init:()=>{B.init(),K.init(),U.init(),G.init(),r=document.getElementById("comments"),r.addEventListener("comment.show",s),n=H("owns"),o=H("comment"),o.has("hidden")||o.set("hidden",[]),o.has("show")||o.set("show",[])},send:async m=>{let a=m.getAttribute("data-uuid"),f=document.getElementById("form-name"),e=f.value;if(e.length===0){alert("Name cannot be empty."),a&&f.scrollIntoView({block:"center"});return}let b=document.getElementById("form-presence");if(!a&&b&&b.value==="0"){alert("Please select your attendance status.");return}let L=B.isOpen(a||B.default),S=B.getResultId(a||B.default),P=B.buttonCancel(a);if(L&&!S){alert("Gif cannot be empty.");return}L&&S&&P.hide();let _=document.getElementById(`form-${a?`inner-${a}`:"comment"}`);if(!L&&_.value?.trim().length===0){alert("Comments cannot be empty.");return}!a&&f&&!R.isAdmin()&&(f.disabled=!0),!R.isAdmin()&&b&&b.value!=="0"&&(b.disabled=!0),_&&(_.disabled=!0);let N=document.querySelector(`[onclick="undangan.comment.cancel(this, '${a}')"]`);N&&(N.disabled=!0);let W=h.disableButton(m),u=b?b.value==="1":!0;if(!R.isAdmin()){let x=H("information");x.set("name",e),a||x.set("presence",u)}let l=await F(X,`/api/comment?lang=${J.getLanguage()}`).token(R.getToken()).body(z.postCommentRequest(a,e,u,L?null:_.value,S)).send(z.getCommentResponse).then(x=>x,()=>null);if(f&&(f.disabled=!1),_&&(_.disabled=!1),N&&(N.disabled=!1),b&&(b.disabled=!1),L&&S&&P.show(),W.restore(),!(!l||l.code!==201)){if(n.set(l.data.uuid,l.data.own),_&&(_.value=null),L&&S&&P.click(),!a){if(G.reset()){await s(),r.scrollIntoView();return}G.setTotal(G.geTotal()+1),r.children.length===G.getPer()&&r.lastElementChild.remove(),l.data.is_parent=!0,l.data.is_admin=R.isAdmin();let x=await U.renderContentMany([l.data]);r.insertAdjacentHTML("afterbegin",x),r.scrollIntoView()}if(a){o.set("hidden",o.get("hidden").concat([z.commentShowMore(l.data.uuid,!0)])),o.set("show",o.get("show").concat([a])),w(a),l.data.is_parent=!1,l.data.is_admin=R.isAdmin(),document.getElementById(`reply-content-${a}`).insertAdjacentHTML("beforeend",await U.renderContentSingle(l.data));let x=document.getElementById(`button-${a}`).querySelector("a"),C=[l.data.uuid];x&&(x.getAttribute("data-show")==="false"&&k(x),x.remove());let q=document.createRange().createContextualFragment(U.renderReadMore(a,x?x.getAttribute("data-uuids").split(",").concat(C):C)),D=K.getButtonLike(a);D.parentNode.insertBefore(q,D)}K.addListener(l.data.uuid),c.push(l.data.uuid)}},edit:async(m,a)=>{let f=m.getAttribute("data-uuid");v(f,!0),R.isAdmin()&&n.set(f,m.getAttribute("data-own"));let e=document.getElementById(`badge-${f}`),b=!!e&&e.getAttribute("data-is-presence")==="true",L=document.getElementById(`img-gif-${f}`);L&&await B.remove(f);let S=a&&!R.isAdmin();if(document.getElementById(`button-${f}`).insertAdjacentElement("afterend",U.renderEdit(f,b,S,!!L)),L){B.onOpen(f,()=>{B.removeGifSearch(f),B.removeButtonBack(f)}),await B.open(f);return}let P=document.getElementById(`form-inner-${f}`),_=h.base64Decode(document.getElementById(`content-${f}`)?.getAttribute("data-comment"));P.value=_,P.setAttribute("data-original",h.base64Encode(_))},reply:m=>{v(m,!0),B.remove(m).then(()=>{B.onOpen(m,()=>B.removeGifSearch(m)),document.getElementById(`button-${m}`).insertAdjacentElement("afterend",U.renderReply(m))})},remove:async m=>{if(!confirm("Are you sure?"))return;let a=m.getAttribute("data-uuid");R.isAdmin()&&n.set(a,m.getAttribute("data-own")),v(a,!0);let f=h.disableButton(m),e=K.getButtonLike(a);if(e.disabled=!0,!await F(me,"/api/comment/"+n.get(a)).token(R.getToken()).send(z.statusResponse).then(L=>L.data.status,()=>!1)){f.restore(),e.disabled=!1,v(a,!1);return}document.querySelectorAll('a[onclick="undangan.comment.showOrHide(this)"]').forEach(L=>{let S=L.getAttribute("data-uuids").split(",");if(S.find(P=>P===a)){let P=S.filter(_=>_!==a).join(",");P.length===0?L.remove():L.setAttribute("data-uuids",P)}}),n.unset(a),document.getElementById(a).remove(),r.children.length===0&&(r.innerHTML=y())},update:async m=>{let a=m.getAttribute("data-uuid"),f=!1,e=document.getElementById(`form-inner-presence-${a}`);e&&(e.disabled=!0,f=e.value==="1");let b=document.getElementById(`badge-${a}`),L=!!b&&b.getAttribute("data-is-presence")==="true",S=B.isOpen(a),P=B.getResultId(a),_=B.buttonCancel(a);if(S&&!P){alert("Gif cannot be empty.");return}S&&P&&_.hide();let N=document.getElementById(`form-inner-${a}`);if(a&&!S&&h.base64Encode(N.value)===N.getAttribute("data-original")&&L===f){w(a);return}if(!S&&N.value?.trim().length===0){alert("Comments cannot be empty.");return}N&&(N.disabled=!0);let W=document.querySelector(`[onclick="undangan.comment.cancel(this, '${a}')"]`);W&&(W.disabled=!0);let u=h.disableButton(m),l=await F(ce,`/api/comment/${n.get(a)}?lang=${J.getLanguage()}`).token(R.getToken()).body(z.updateCommentRequest(e?f:null,S?null:N.value,P)).send(z.statusResponse).then(x=>x.data.status,()=>!1);if(N&&(N.disabled=!1),W&&(W.disabled=!1),e&&(e.disabled=!1),u.restore(),S&&P&&_.show(),!!l){if(S&&P&&(document.getElementById(`img-gif-${a}`).src=document.getElementById(`gif-result-${a}`)?.querySelector("img").src,_.click()),w(a),!S){let x=document.querySelector(`[onclick="undangan.comment.showMore(this, '${a}')"]`),C=document.getElementById(`content-${a}`);C.setAttribute("data-comment",h.base64Encode(N.value));let q=U.convertMarkdownToHTML(h.escapeHtml(N.value));N.value.length>U.maxCommentLength?(h.safeInnerHTML(C,x?.getAttribute("data-show")==="false"?q.slice(0,U.maxCommentLength)+"...":q),x?.classList.replace("d-none","d-block")):(h.safeInnerHTML(C,q),x?.classList.replace("d-block","d-none"))}e&&(document.getElementById("form-presence").value=f?"1":"2",H("information").set("presence",f)),!(!e||!b)&&(b.classList.toggle("fa-circle-xmark",!f),b.classList.toggle("text-danger",!f),b.classList.toggle("fa-circle-check",f),b.classList.toggle("text-success",f))}},cancel:async(m,a)=>{let f=document.getElementById(`form-inner-presence-${a}`),e=f?f.value==="1":!1,b=document.getElementById(`badge-${a}`),L=b&&n.has(a)&&f?b.getAttribute("data-is-presence")==="true":!1;if(h.disableButton(m),B.isOpen(a)&&(!B.getResultId(a)&&L===e||confirm("Are you sure?"))){await B.remove(a),w(a);return}let S=document.getElementById(`form-inner-${a}`);(S.value.length===0||h.base64Encode(S.value)===S.getAttribute("data-original")&&L===e||confirm("Are you sure?"))&&w(a)},show:s,showMore:p,showOrHide:k}})();var be=(()=>{let n=null,o=()=>{let t=document.getElementById("count-down")?.getAttribute("data-time")?.replace(" ","T");if(!t){alert("Invalid countdown date.");return}let i=new Date(t).getTime(),g=()=>{let T=Math.abs(i-Date.now());document.getElementById("day").innerText=Math.floor(T/(1e3*60*60*24)).toString(),document.getElementById("hour").innerText=Math.floor(T%(1e3*60*60*24)/(1e3*60*60)).toString(),document.getElementById("minute").innerText=Math.floor(T%(1e3*60*60)/(1e3*60)).toString(),document.getElementById("second").innerText=Math.floor(T%(1e3*60)/1e3).toString(),h.timeOut(g,1e3-Date.now()%1e3)};requestAnimationFrame(g)},r=()=>{let t=window.location.search.split("to="),i=null;if(t.length>1&&t[1].length>=1&&(i=window.decodeURIComponent(t[1])),i){let T=document.getElementById("guest-name"),E=document.createElement("div");E.classList.add("m-2");let I=`<small class="mt-0 mb-1 mx-0 p-0">${h.escapeHtml(T?.getAttribute("data-message"))}</small><p class="m-0 p-0" style="font-size: 1.5rem">${h.escapeHtml(i)}</p>`;h.safeInnerHTML(E,I),T?.appendChild(E)}let g=document.getElementById("form-name");g&&(g.value=n.get("name")??i)},c=async()=>{let t=0,i=0,g=6e3,T=document.querySelectorAll(".slide-desktop");for(let[A,m]of T.entries())if(A===t){m.classList.add("slide-desktop-active"),await h.changeOpacity(m,!0);break}let E=async()=>{await h.changeOpacity(T[t],!1),T[t].classList.remove("slide-desktop-active"),t=(t+1)%T.length,T[t].classList.add("slide-desktop-active"),await h.changeOpacity(T[t],!0)},I=async A=>{A-i>=g&&(i=A,await E()),requestAnimationFrame(I)};h.timeOut(I,g)},y=t=>{t.disabled=!0,document.body.scrollIntoView({behavior:"instant"}),document.dispatchEvent(new Event("undangan.open")),Z.isAutoMode()&&document.getElementById("button-theme").classList.remove("d-none"),c(),ne.play(),Z.spyTop(),ge(),h.timeOut(pe,1500),h.changeOpacity(document.getElementById("welcome"),!1).then(i=>i.remove())},v=()=>n.set("info",!0),w=()=>{document.querySelectorAll(".font-arabic").forEach(t=>{t.innerHTML=String(t.innerHTML).normalize("NFC")})},k=()=>{document.querySelectorAll("svg").forEach(t=>{h.timeOut(()=>t.classList.add(t.getAttribute("data-class")),parseInt(t.getAttribute("data-time")))})},p=()=>{let t=T=>new Date(T+":00Z").toISOString().replace(/[-:]/g,"").split(".").shift(),i=new URL("https://calendar.google.com/calendar/render"),g={action:"TEMPLATE",text:"The Wedding of Taufik and Tuswati",dates:`${t("2025-06-16 10:00")}/${t("2025-06-16 12:00")}`,details:"Tanpa mengurangi rasa hormat, kami mengundang Anda untuk berkenan menghadiri acara pernikahan kami. Terima kasih atas perhatian dan doa restu Anda, yang menjadi kebahagiaan serta kehormatan besar bagi kami.",location:"https://maps.app.goo.gl/1GbUPa4ESBukPkKx6",ctz:"Asia/Jakarta"};Object.entries(g).forEach(([T,E])=>i.searchParams.set(T,E)),document.querySelector("#home button")?.addEventListener("click",()=>window.open(i,"_blank"))},$=async()=>{k(),o(),r(),w(),p(),document.getElementById("root").classList.remove("opacity-0"),n.has("presence")&&(document.getElementById("form-presence").value=n.get("presence")?"1":"2"),n.get("info")&&document.getElementById("information")?.remove(),window.AOS.init(),document.body.scrollIntoView({behavior:"instant"}),await h.changeOpacity(document.getElementById("welcome"),!0),await h.changeOpacity(document.getElementById("loading"),!1).then(t=>t.remove())},d=()=>{J.init(),ue.init(),O.init(),n=H("information");let t=document.body.getAttribute("data-key");if(document.addEventListener("progress.done",()=>$()),(!t||t.length<=0)&&(O.add(),O.add(),ne.init(),document.body.getAttribute("data-confetti")==="true"?re().then(()=>O.complete("confetti")).catch(()=>O.invalid("confetti")):O.complete("confetti",!0),document.getElementById("comment")?.remove(),document.querySelector('a.nav-link[href="#comment"]')?.closest("li.nav-item")?.remove()),t&&t.length>0){O.add(),O.add(),O.add(),O.add();let i=new URLSearchParams(window.location.search);R.setToken(i.get("k")??t),window.addEventListener("load",()=>R.guest().then(g=>{O.complete("config"),ne.init(),oe.init(),g.data.is_confetti_animation?re().then(()=>O.complete("confetti")).catch(()=>O.invalid("confetti")):O.complete("confetti",!0),oe.show().then(()=>{O.complete("comment")}).catch(()=>O.invalid("comment"))}).catch(()=>O.invalid("config")))}};return{init:()=>(Z.init(),R.init(),R.isAdmin()&&(H("user").clear(),H("owns").clear(),H("likes").clear(),H("session").clear(),H("comment").clear()),window.addEventListener("DOMContentLoaded",d),{util:h,theme:Z,comment:oe,guest:{open:y,closeInformation:v}})}})();(n=>{n.undangan=be.init()})(window);})();
